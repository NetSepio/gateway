# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

image:
  file: .gitpod.Dockerfile
tasks:
  - name: golang live
    init: |
      aptos init --private-key $APTOS_PV --network testnet
      go install gotest.tools/gotestsum@latest
      go get

    command: |
      docker run --name="netsepio" --rm -d -p 5432:5432 \
      -e POSTGRES_PASSWORD=netsepio \
      -e POSTGRES_USER=netsepio \
      -e POSTGRES_DB=netsepio \
      postgres -c log_statement=all
      sleep 12
      migrate -database "postgres://netsepio:netsepio@localhost:5432/netsepio?sslmode=disable" -path migrations up
      gp sync-done db
      cp .env-sample .env
      aptos account fund-with-faucet
      DEBUG_MODE=true air
  
  - name: postgres shell
    command: |
      gp sync-await db
      docker exec -it netsepio psql -U netsepio
    
vscode:
  extensions:
    - golang.go
